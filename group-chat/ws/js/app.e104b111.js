(function(){"use strict";var e={5365:function(e,t,n){var s=n(5130),o=n(6768);function i(e,t,n,s,i,a){const r=(0,o.g2)("router-view"),l=(0,o.g2)("ToastContainer");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(r),(0,o.bF)(l,{ref:"toastContainer"},null,512)],64)}const a={class:"toast-container"};function r(e,t,n,s,i,r){const l=(0,o.g2)("ToastNotification");return(0,o.uX)(),(0,o.CE)("div",a,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.toasts,(e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.id,message:e.message,type:e.type,duration:e.duration,visible:e.visible,onClose:t=>r.removeToast(e.id)},null,8,["message","type","duration","visible","onClose"])))),128))])}n(4114),n(8111),n(7588);var l=n(4232);const c={class:"toast-content"},u={class:"toast-message"};function d(e,t,n,i,a,r){return(0,o.uX)(),(0,o.Wv)(s.eB,{name:"toast"},{default:(0,o.k6)((()=>[n.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,l.C4)(["toast",`toast-${n.type}`])},[(0,o.Lk)("div",c,[(0,o.Lk)("i",{class:(0,l.C4)(r.iconClass)},null,2),(0,o.Lk)("span",u,(0,l.v_)(n.message),1)])],2)):(0,o.Q3)("",!0)])),_:1})}var h={name:"ToastNotification",props:{message:{type:String,required:!0},type:{type:String,default:"info",validator:e=>["info","success","warning","error"].includes(e)},duration:{type:Number,default:3e3},visible:{type:Boolean,default:!1}},computed:{iconClass(){const e={info:"toast-icon-info",success:"toast-icon-success",warning:"toast-icon-warning",error:"toast-icon-error"};return e[this.type]||e.info}},watch:{visible(e){e&&this.duration>0&&setTimeout((()=>{this.$emit("close")}),this.duration)}}},m=n(1241);const p=(0,m.A)(h,[["render",d],["__scopeId","data-v-bdc5514a"]]);var g=p,f={name:"ToastContainer",components:{ToastNotification:g},data(){return{toasts:[],nextId:1}},methods:{addToast(e){const t={id:this.nextId++,message:e.message||"",type:e.type||"info",duration:e.duration||3e3,visible:!0};return this.toasts.push(t),this.toasts.length>5&&this.removeToast(this.toasts[0].id),t.id},removeToast(e){const t=this.toasts.findIndex((t=>t.id===e));t>-1&&(this.toasts[t].visible=!1,setTimeout((()=>{const t=this.toasts.findIndex((t=>t.id===e));t>-1&&this.toasts.splice(t,1)}),300))},clearAll(){this.toasts.forEach((e=>{e.visible=!1})),setTimeout((()=>{this.toasts=[]}),300)}}};const v=(0,m.A)(f,[["render",r],["__scopeId","data-v-3b33102b"]]);var w=v;class S{constructor(){this.container=null}setContainer(e){this.container=e}info(e,t=3e3){return this.show({message:e,type:"info",duration:t})}success(e,t=3e3){return this.show({message:e,type:"success",duration:t})}warning(e,t=3e3){return this.show({message:e,type:"warning",duration:t})}error(e,t=3e3){return this.show({message:e,type:"error",duration:t})}show(e){return this.container?this.container.addToast(e):(console.warn("Toast container not initialized"),null)}remove(e){this.container&&this.container.removeToast(e)}clear(){this.container&&this.container.clearAll()}}const y=new S;var k={name:"App",components:{ToastContainer:w},mounted(){y.setContainer(this.$refs.toastContainer)}};const C=(0,m.A)(k,[["render",i]]);var b=C,M=n(1387),x=n.p+"img/logo.4dd8e820.png";const T={class:"chat-view"},$={class:"nav-bar"},I={class:"chat-container"};function U(e,t,n,s,i,a){const r=(0,o.g2)("MessageList"),c=(0,o.g2)("ScrollToBottomButton"),u=(0,o.g2)("ConnectionStatus"),d=(0,o.g2)("ChatInput");return(0,o.uX)(),(0,o.CE)("div",T,[(0,o.Lk)("div",$,[t[1]||(t[1]=(0,o.Lk)("div",{class:"nav-left"},[(0,o.Lk)("img",{src:x,alt:"",class:"nav-logo"}),(0,o.Lk)("h1",{class:"nav-title"},[(0,o.Lk)("a",{href:"https://github.com/eastspire/hyperlane",target:"_blank"}," Hyperlane Chat ")])],-1)),(0,o.Lk)("div",{class:(0,l.C4)(["connection-indicator",i.connectionStatus])},[t[0]||(t[0]=(0,o.Lk)("span",{class:"status-dot"},null,-1)),(0,o.eW)(" "+(0,l.v_)("connected"===i.connectionStatus?"Online":"Offline"),1)],2)]),(0,o.Lk)("div",I,[(0,o.bF)(r,{messages:i.messages,isNearBottom:i.isNearBottom,name:i.username,onHandleScroll:a.handleScroll,onMentionUser:a.handleMentionUser,ref:"messageListRef"},null,8,["messages","isNearBottom","name","onHandleScroll","onMentionUser"]),i.showScrollButton?((0,o.uX)(),(0,o.Wv)(c,{key:0,unreadCount:i.unreadCount,onClick:a.scrollToBottom},null,8,["unreadCount","onClick"])):(0,o.Q3)("",!0),"connected"!==i.connectionStatus?((0,o.uX)(),(0,o.Wv)(u,{key:1,status:i.connectionStatus},null,8,["status"])):(0,o.Q3)("",!0),(0,o.bF)(d,{connectionStatus:i.connectionStatus,onlineCountText:i.onlineCountText,onSendMessage:a.sendMessage,ref:"chatInputRef"},null,8,["connectionStatus","onlineCountText","onSendMessage"])])])}const L={class:"message-info"},_={class:"message-content gpt-response"},B={class:"message-time"},E={class:"message-info"},H={class:"message-content"},D={class:"message-time"},A={class:"message-info self"},F={class:"message-content self"},R={class:"message-time"};function X(e,t,n,s,i,a){const r=(0,o.g2)("MessageAvatar"),c=(0,o.g2)("MessageHeader"),u=(0,o.g2)("MessageText"),d=(0,o.g2)("ScrollList");return(0,o.uX)(),(0,o.Wv)(d,{class:"chat-messages",ref:"messageContainer",items:n.messages,containerHeight:i.containerHeight,estimatedItemHeight:80,bufferSize:5,onHandleScroll:a.handleScroll},{default:(0,o.k6)((({item:e})=>[(0,o.Lk)("div",{class:(0,l.C4)(["message",a.isMe(e)&&!e.isGptResponse?"self-message":"other-message",e.isGptResponse?"gpt-message":""])},[e.isGptResponse?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(r,{name:"gpt",isSelf:!1,isGpt:!0}),(0,o.Lk)("div",L,[(0,o.bF)(c,{name:"gpt",time:e.time,isSelf:!1,isGpt:!0,onMentionUser:a.handleMentionUser},null,8,["time","onMentionUser"]),(0,o.Lk)("div",_,[(0,o.bF)(u,{text:e.data},null,8,["text"])]),(0,o.Lk)("div",B,(0,l.v_)(e.time),1)])],64)):a.isMe(e)?((0,o.uX)(),(0,o.CE)(o.FK,{key:2},[(0,o.Lk)("div",A,[(0,o.bF)(c,{name:e.name,time:e.time,isSelf:!0,onMentionUser:a.handleMentionUser},null,8,["name","time","onMentionUser"]),(0,o.Lk)("div",F,[(0,o.bF)(u,{text:e.data},null,8,["text"])]),(0,o.Lk)("div",R,(0,l.v_)(e.time),1)]),(0,o.bF)(r,{name:e.name,isSelf:!0},null,8,["name"])],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(r,{name:e.name,isSelf:!1},null,8,["name"]),(0,o.Lk)("div",E,[(0,o.bF)(c,{name:e.name,time:e.time,isSelf:!1,onMentionUser:a.handleMentionUser},null,8,["name","time","onMentionUser"]),(0,o.Lk)("div",H,[(0,o.bF)(u,{text:e.data},null,8,["text"])]),(0,o.Lk)("div",D,(0,l.v_)(e.time),1)])],64))],2)])),_:1},8,["items","containerHeight","onHandleScroll"])}function O(e,t,n,s,i,a){return(0,o.uX)(),(0,o.CE)("div",{class:(0,l.C4)(["avatar",n.isSelf?"self":"",n.isGpt?"gpt":""])},(0,l.v_)(n.isGpt?"🤖":n.name?.charAt(0)),3)}var K={name:"MessageAvatar",props:{name:{type:String,required:!0},isSelf:{type:Boolean,default:!1},isGpt:{type:Boolean,default:!1}}};const N=(0,m.A)(K,[["render",O],["__scopeId","data-v-d0ebf6d2"]]);var P=N;const G={class:"message-header"};function q(e,t,n,s,i,a){return(0,o.uX)(),(0,o.CE)("div",G,[(0,o.Lk)("div",{class:(0,l.C4)(["name",n.isGpt?"gpt-name":"",n.isGpt||n.isSelf?"":"clickable"]),onClick:t[0]||(t[0]=(...e)=>a.handleNameClick&&a.handleNameClick(...e))},(0,l.v_)(n.name),3)])}var W={name:"MessageHeader",props:{name:{type:String,required:!0},time:{type:String,required:!0},isSelf:{type:Boolean,default:!1},isGpt:{type:Boolean,default:!1}},methods:{handleNameClick(){this.isGpt||this.isSelf||this.$emit("mention-user",this.name)}}};const j=(0,m.A)(W,[["render",q],["__scopeId","data-v-fe0786e2"]]);var z=j;const Q=["innerHTML"];function J(e,t,n,s,i,a){return(0,o.uX)(),(0,o.CE)("div",{class:"message-text",innerHTML:a.formattedText},null,8,Q)}var V=n(4911),Y=n(3873),Z=n.n(Y);const ee=function(){const e="browser_uuid";let t=localStorage.getItem(e);return t||(t=crypto.randomUUID(),localStorage.setItem(e,t)),t};var te={name:"MessageText",props:{text:{type:String,required:!0}},computed:{formattedText(){const e=this.renderMarkdown(this.text);return this.formatMentions(e)}},data(){return{md:null}},mounted(){this.md=new V.A({html:!0,linkify:!0,typographer:!0,breaks:!0}).use(Z()).use(this.customLinkPlugin).use(this.customImagePlugin)},methods:{customLinkPlugin(e){const t=e.renderer.rules.link_open||function(e,t,n,s,o){return o.renderToken(e,t,n)};e.renderer.rules.link_open=function(e,n,s,o,i){const a=e[n];return a.attrSet("target","_blank"),a.attrSet("rel","noopener noreferrer"),t(e,n,s,o,i)}},customImagePlugin(e){const t=e.renderer.rules.image||function(e,t,n,s,o){return o.renderToken(e,t,n)};e.renderer.rules.image=function(e,n,s,o,i){const a=e[n];return a.attrSet("class","markdown-image"),t(e,n,s,o,i)}},renderMarkdown(e){try{return this.md?this.md.render(e):e}catch(t){return console.warn("Markdown parsing error:",t),e}},formatMentions(e){const t=ee(),n=`User${t}`,s=/@([^\s@]+|"[^"]+"|'[^']+'|[\u4e00-\u9fa5]+\d*)/g;return e.replace(s,((e,s)=>{const o=s.replace(/^["']|["']$/g,""),i=this.isCurrentUser(o,t,n);return i?`<span class="mention mention-self">${e}</span>`:`<span class="mention mention-other">${e}</span>`}))},isCurrentUser(e,t,n){const s=[t,n,"me","Me","ME","@me"];return s.some((t=>e.toLowerCase()===t.toLowerCase()))}}};const ne=(0,m.A)(te,[["render",J],["__scopeId","data-v-4cebbe26"]]);var se=ne;const oe={class:"list-content"};function ie(e,t,n,s,i,a){return(0,o.uX)(),(0,o.CE)("div",{class:"list-container",ref:"container",onScroll:t[0]||(t[0]=(...e)=>a.onScroll&&a.onScroll(...e)),style:(0,l.Tr)({height:n.containerHeight+"px"})},[(0,o.Lk)("div",oe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.items,((t,n)=>(0,o.RG)(e.$slots,"default",{item:t,index:n,key:n},void 0,!0))),128))])],36)}var ae={name:"ScrollList",props:{items:{type:Array,required:!0},containerHeight:{type:Number,default:500}},data(){return{canScroll:!1}},methods:{onScroll(e){const t=e.target,n=t.scrollTop,s=t.clientHeight,o=t.scrollHeight,i=o-n-s,a=i<100;this.$emit("handleScroll",a)},scrollToBottom(){if(!this.$refs.container)return;const e=this.$refs.container,t=e.scrollHeight,n=e.clientHeight;t>n&&requestAnimationFrame((()=>{e.scrollTop=e.scrollHeight}))},checkScrollable(){if(!this.$refs.container)return!1;const e=this.$refs.container,t=e.scrollHeight,n=e.clientHeight;return this.canScroll=t>n,this.canScroll}},watch:{items:{handler(){this.$nextTick((()=>{this.checkScrollable()}))},deep:!0}}};const re=(0,m.A)(ae,[["render",ie],["__scopeId","data-v-40835dff"]]);var le=re,ce={name:"MessageList",components:{MessageAvatar:P,MessageHeader:z,MessageText:se,ScrollList:le},props:{messages:{type:Array,required:!0},isNearBottom:{type:Boolean,default:!0},name:{type:String,required:!0}},data(){return{containerHeight:0,shouldAutoScroll:!0}},mounted(){this.updateContainerHeight(),window.addEventListener("resize",this.updateContainerHeight)},beforeUnmount(){window.removeEventListener("resize",this.updateContainerHeight)},methods:{isMe(e){return e?.name==ee()},updateContainerHeight(){this.containerHeight=window.innerHeight-108},scrollToBottom(){const e=this.$refs.messageContainer;if(e){const t=e.checkScrollable();t&&e.scrollToBottom()}},handleScroll(e){const t=this.$refs.messageContainer;t&&t.canScroll?this.$emit("handleScroll",e):this.$emit("handleScroll",!0)},handleMentionUser(e){this.$emit("mention-user",e)}},watch:{messages:{handler(){this.$nextTick((()=>{const e=this.$refs.messageContainer;if(e){const t=e.checkScrollable();t&&this.shouldAutoScroll&&this.scrollToBottom()}}))},deep:!0}}};const ue=(0,m.A)(ce,[["render",X],["__scopeId","data-v-cdaf495e"]]);var de=ue;const he={class:"chat-input",ref:"chatInputContainer"},me=["placeholder","disabled"],pe=["disabled"];function ge(e,t,n,i,a,r){const l=(0,o.g2)("UserMentionDropdown");return(0,o.uX)(),(0,o.CE)("div",he,[(0,o.bo)((0,o.Lk)("textarea",{ref:"messageInput","onUpdate:modelValue":t[0]||(t[0]=e=>a.message=e),onKeydown:t[1]||(t[1]=(...e)=>r.handleKeyDown&&r.handleKeyDown(...e)),onKeyup:t[2]||(t[2]=(...e)=>r.handleKeyUp&&r.handleKeyUp(...e)),onInput:t[3]||(t[3]=(...e)=>r.handleInput&&r.handleInput(...e)),placeholder:r.placeholderText,disabled:"connected"!==n.connectionStatus,rows:"1"},null,40,me),[[s.Jo,a.message]]),(0,o.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.sendMessage&&r.sendMessage(...e)),disabled:"connected"!==n.connectionStatus},t[5]||(t[5]=[(0,o.Lk)("span",null,"Send",-1),(0,o.Lk)("i",{class:"send-icon"},"➤",-1)]),8,pe),(0,o.bF)(l,{visible:a.showMentionDropdown,users:a.onlineUsers,filter:a.mentionFilter,position:a.dropdownPosition,loading:a.loadingUsers,onSelectUser:r.selectMentionUser,onClose:r.closeMentionDropdown},null,8,["visible","users","filter","position","loading","onSelectUser","onClose"])],512)}const fe={class:"mention-list"},ve={key:0,class:"loading-container"},we=["onClick","onMouseenter"],Se={class:"user-info"},ye={key:0,class:"no-users"};function ke(e,t,n,s,i,a){return n.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"mention-dropdown",style:(0,l.Tr)(a.dropdownStyle)},[t[1]||(t[1]=(0,o.Lk)("div",{class:"mention-header"},"Select User",-1)),(0,o.Lk)("div",fe,[n.loading?((0,o.uX)(),(0,o.CE)("div",ve,t[0]||(t[0]=[(0,o.Lk)("div",{class:"loading-spinner"},null,-1),(0,o.Lk)("div",{class:"loading-text"},"Loading users...",-1)]))):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.filteredUsers,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:e.user_id,class:(0,l.C4)(["mention-item",{active:t===i.selectedIndex,"gpt-user":"gpt"===e.user_id}]),onClick:t=>a.selectUser(e),onMouseenter:e=>i.selectedIndex=t},[(0,o.Lk)("div",{class:(0,l.C4)(["user-avatar",{"gpt-avatar":"gpt"===e.username,"other-user-avatar":"gpt"!==e.username}])},(0,l.v_)("gpt"===e.username?"🤖":e.username.charAt(0)),3),(0,o.Lk)("div",Se,[(0,o.Lk)("div",{class:(0,l.C4)(["user-name",{"gpt-name":"GPT"===e.username}])},(0,l.v_)(e.username),3)])],42,we)))),128)),0===a.filteredUsers.length?((0,o.uX)(),(0,o.CE)("div",ye," No matching users found ")):(0,o.Q3)("",!0)],64))])],4)):(0,o.Q3)("",!0)}n(2489);var Ce={name:"UserMentionDropdown",props:{visible:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},filter:{type:String,default:""},position:{type:Object,default:()=>({x:0,y:0,maxHeight:200})},loading:{type:Boolean,default:!1}},data(){return{selectedIndex:0}},computed:{filteredUsers(){if(!this.filter)return this.users;const e=this.filter.toLowerCase();return this.users.filter((t=>t.username.toLowerCase().includes(e)))},dropdownStyle(){return{maxHeight:`${this.position.maxHeight||200}px`}}},watch:{filteredUsers(){this.selectedIndex=0},visible(e){e&&(this.selectedIndex=0,this.$nextTick((()=>{this.scrollToSelected()})))}},methods:{selectUser(e){this.$emit("select-user",e)},handleKeyDown(e){if(this.visible)switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.filteredUsers.length-1),this.scrollToSelected();break;case"ArrowUp":e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.scrollToSelected();break;case"Enter":e.preventDefault(),this.filteredUsers[this.selectedIndex]&&this.selectUser(this.filteredUsers[this.selectedIndex]);break;case"Escape":e.preventDefault(),this.$emit("close");break}},scrollToSelected(){this.$nextTick((()=>{const e=this.$el.querySelector(".mention-list"),t=this.$el.querySelector(".mention-item.active");if(e&&t){const n=e.getBoundingClientRect(),s=t.getBoundingClientRect();s.bottom>n.bottom?e.scrollTop+=s.bottom-n.bottom:s.top<n.top&&(e.scrollTop-=n.top-s.top)}}))}},mounted(){document.addEventListener("keydown",this.handleKeyDown)},beforeUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}};const be=(0,m.A)(Ce,[["render",ke],["__scopeId","data-v-59fc3c8e"]]);var Me=be,xe={name:"ChatInput",components:{UserMentionDropdown:Me},props:{connectionStatus:{type:String,required:!0},onlineCountText:{type:String,default:""}},data(){return{message:"",showMentionDropdown:!1,mentionFilter:"",mentionStartIndex:-1,onlineUsers:[],dropdownPosition:{x:0,y:0},loadingUsers:!1}},computed:{placeholderText(){const e="(use @name to mention users, ctrl+enter or shift+enter for new line)";return this.onlineCountText?`${this.onlineCountText} ${e}`:e}},mounted(){this.$nextTick((()=>{this.autoResize()}))},methods:{sendMessage(){"connected"===this.connectionStatus&&(this.message.trim()?(this.$emit("send-message",this.message),this.message="",this.closeMentionDropdown(),this.$nextTick((()=>{this.autoResize()}))):y.warning("Please enter a message before sending."))},addMention(e){const t=`@${e} `;this.message.trim()?this.message+=" "+t:this.message=t,this.$nextTick((()=>{const e=this.$refs.messageInput;e&&(e.focus(),e.setSelectionRange(e.value.length,e.value.length))}))},async fetchOnlineUsers(){if(!this.loadingUsers){this.loadingUsers=!0;try{const e=window.location.protocol,t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"localhost:60006":window.location.hostname,n=await fetch(`${e}//${t}/api/users/online`);if(n.ok){const e=await n.json();this.onlineUsers=e.users||[]}}catch(e){console.error("Failed to fetch online users list:",e),this.onlineUsers=[]}finally{this.loadingUsers=!1}}},handleKeyDown(e){if((!this.showMentionDropdown||!["ArrowDown","ArrowUp","Enter","Escape"].includes(e.key))&&"Enter"===e.key&&!this.showMentionDropdown)if(e.ctrlKey||e.shiftKey){e.preventDefault();const t=this.$refs.messageInput,n=t.selectionStart,s=t.selectionEnd,o=t.value;this.message=o.substring(0,n)+"\n"+o.substring(s),this.$nextTick((()=>{t.selectionStart=t.selectionEnd=n+1,this.autoResize()}))}else e.preventDefault(),this.sendMessage()},handleKeyUp(){this.checkMentionTrigger()},handleInput(){this.checkMentionTrigger(),this.autoResize()},autoResize(){const e=this.$refs.messageInput;if(e){e.style.height="auto";const t=20,n=t,s=5*t,o=Math.min(Math.max(e.scrollHeight,n),s);e.style.height=o+"px",e.scrollHeight>s?e.style.overflowY="auto":e.style.overflowY="hidden"}},checkMentionTrigger(){const e=this.$refs.messageInput,t=e.selectionStart,n=this.message;let s=-1;for(let o=t-1;o>=0;o--){if("@"===n[o]){s=o;break}if(" "===n[o]||"\n"===n[o])break}if(-1!==s){const o=n.substring(s+1,t);this.mentionFilter=o,this.mentionStartIndex=s,this.showMentionDropdown||(this.showMentionDropdown=!0,this.fetchOnlineUsers()),this.calculateDropdownPosition(e,s)}else this.closeMentionDropdown()},calculateDropdownPosition(e){const t=this.$refs.chatInputContainer.getBoundingClientRect(),n=e.getBoundingClientRect(),s=document.createElement("canvas"),o=s.getContext("2d"),i=window.getComputedStyle(e);o.font=`${i.fontSize} ${i.fontFamily}`;const a=n.top-20,r=Math.max(120,Math.min(250,a-6)),l=280,c=t.width,u=12;let d=u;d+l>c&&(d=c-l),d<0&&(d=0),this.dropdownPosition={x:d,maxHeight:r}},selectMentionUser(e){const t=this.message.substring(0,this.mentionStartIndex),n=this.message.substring(this.$refs.messageInput.selectionStart);this.message=t+`@${e.username} `+n,this.closeMentionDropdown(),this.$nextTick((()=>{const n=t.length+e.username.length+2;this.$refs.messageInput.setSelectionRange(n,n),this.$refs.messageInput.focus()}))},closeMentionDropdown(){this.showMentionDropdown=!1,this.mentionFilter="",this.mentionStartIndex=-1}}};const Te=(0,m.A)(xe,[["render",ge],["__scopeId","data-v-0fd67ed2"]]);var $e=Te;const Ie={class:"connection-status"};function Ue(e,t,n,s,i,a){return(0,o.uX)(),(0,o.CE)("div",Ie,[t[0]||(t[0]=(0,o.Lk)("i",{class:"status-icon"},"⚠️",-1)),(0,o.eW)(" "+(0,l.v_)(a.statusMessage),1)])}var Le={name:"ConnectionStatus",props:{status:{type:String,required:!0}},computed:{statusMessage(){const e={disconnected:"未连接到服务器",connecting:"正在连接...",connected:"已连接"};return e[this.status]||"未知状态"}}};const _e=(0,m.A)(Le,[["render",Ue],["__scopeId","data-v-d1eeae44"]]);var Be=_e;const Ee={key:0,class:"unread-count"};function He(e,t,n,s,i,a){return(0,o.uX)(),(0,o.CE)("div",{class:"scroll-to-bottom",onClick:t[0]||(t[0]=t=>e.$emit("click"))},[n.unreadCount>0?((0,o.uX)(),(0,o.CE)("span",Ee,(0,l.v_)(n.unreadCount),1)):(0,o.Q3)("",!0),t[1]||(t[1]=(0,o.Lk)("i",{class:"scroll-icon"},"↓",-1))])}var De={name:"ScrollToBottomButton",props:{unreadCount:{type:Number,default:0}}};const Ae=(0,m.A)(De,[["render",He],["__scopeId","data-v-ffe9ffec"]]);var Fe=Ae,Re=n(144);const Xe=ee();function Oe({onMessage:e}){const t=(0,Re.KR)(null),n=(0,Re.KR)("disconnected");let s=0;const o=5,i=3e3;let a=null;const r=()=>{n.value="connecting";const o="https:"===window.location.protocol?"wss":"ws",i="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"localhost:60006":window.location.hostname;t.value=new WebSocket(`${o}://${i}/api/ws?uuid=${Xe}`),t.value.onopen=()=>{n.value="connected",clearInterval(a),a=setInterval((()=>{u({type:"Ping",data:""})}),8888)},t.value.onmessage=t=>{try{let n=JSON.parse(t.data);if("Pang"==n.type)return;e(n)}catch(n){e({name:"System",data:t.data,time:(new Date).toLocaleTimeString()})}},t.value.onclose=()=>{n.value="disconnected",c()},t.value.onerror=e=>{n.value="disconnected",console.error("WebSocket错误:",e)},s=0},l=()=>{t.value&&(t.value.close(),t.value=null)},c=()=>{s<o?(s++,setTimeout((()=>{r()}),i)):console.error("达到最大重连次数，停止重连")},u=e=>!(!t.value||t.value.readyState!==WebSocket.OPEN)&&(t.value.send(JSON.stringify(e)),!0);return{connectionStatus:n,connect:r,disconnect:l,sendMessage:u}}const Ke={OnlineCount:"OnlineCount",GptResponse:"GptResponse"};var Ne={name:"ChatView",components:{MessageList:de,ChatInput:$e,ConnectionStatus:Be,ScrollToBottomButton:Fe},data(){return{messages:[],username:"",isNearBottom:!0,showScrollButton:!1,unreadCount:0,connectionStatus:"disconnected",onlineCountText:""}},created(){this.username=this.generateUsername()},mounted(){const{connectionStatus:e,connect:t,disconnect:n,sendMessage:s}=Oe({onMessage:this.handleMessage});this.connect=t,this.disconnect=n,this.sendWebSocketMessage=s,this.wsConnectionStatus=e,this.connectionStatus=e.value,this.$watch((()=>this.wsConnectionStatus.value),(e=>{console.log("WebSocket连接状态变化:",e),this.connectionStatus=e})),this.connect()},beforeUnmount(){this.disconnect()},methods:{generateUsername(){const e=crypto.randomUUID();return`User${e}`},handleMessage(e){const t=e.name===this.username,n=e.type===Ke.GptResponse,s=e.type===Ke.OnlineCount;s&&(this.onlineCountText=e.data),this.messages.push({...e,isSelf:t,isGptResponse:n,isOnlineCount:s}),this.$nextTick((()=>{const e=this.$refs.messageListRef;if(!e)return;const s=e.$refs.messageContainer.checkScrollable();if(!s)return this.showScrollButton=!1,void(this.unreadCount=0);t||n||this.isNearBottom?this.scrollToBottom():(this.unreadCount++,this.showScrollButton=!0)}))},sendMessage(e){if("connected"!==this.connectionStatus)return;if(!e.trim())return void y.warning("Please enter a message before sending.");const t={type:"Text",data:e};this.isNearBottom=!0,this.sendWebSocketMessage(t)},scrollToBottom(){this.$nextTick((()=>{this.$refs.messageListRef&&(this.$refs.messageListRef.scrollToBottom(),this.unreadCount=0,this.showScrollButton=!1,this.isNearBottom=!0)}))},handleScroll(e){this.isNearBottom=e,this.isNearBottom&&this.showScrollButton&&(this.showScrollButton=!1,this.unreadCount=0)},handleMentionUser(e){this.$refs.chatInputRef&&this.$refs.chatInputRef.addMention(e)}}};const Pe=(0,m.A)(Ne,[["render",U],["__scopeId","data-v-45008d60"]]);var Ge=Pe;const qe=!1,We=[{path:qe?"/":"/ws/index.html",name:"chat",component:Ge}],je=(0,M.aE)({history:(0,M.LA)(""),routes:We});var ze=je;const Qe=(0,s.Ef)(b);Qe.use(ze),Qe.mount("#app")}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,s,o,i){if(!s){var a=1/0;for(u=0;u<e.length;u++){s=e[u][0],o=e[u][1],i=e[u][2];for(var r=!0,l=0;l<s.length;l++)(!1&i||a>=i)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(r=!1,i<a&&(a=i));if(r){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[s,o,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p=""}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,i,a=s[0],r=s[1],l=s[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var u=l(n)}for(t&&t(s);c<a.length;c++)i=a[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},s=self["webpackChunkgroup_chat"]=self["webpackChunkgroup_chat"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[504],(function(){return n(5365)}));s=n.O(s)})();